<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>صفحه ۳ — تعریف مجموعه A</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Tahoma,sans-serif;}
body{background:#c0e0a0;color:#222;}
.container{max-width:980px;margin:12px auto;padding:12px;position:relative;}

/* پروفایل */
.profile-container{position:absolute;top:12px;right:12px;display:flex;align-items:center;cursor:pointer;}
.profile-container img{width:45px;height:45px;border-radius:50%;border:2px solid #4caf50;object-fit:cover;}
.profile-popup{position:absolute;top:60px;right:0;background:#d0f0c0;padding:12px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.2);display:none;width:250px;}
.profile-popup button{width:100%;margin:4px 0;padding:6px;border:none;border-radius:6px;background:#1976d2;color:white;cursor:pointer;transition:0.2s;}

/* فرم مجموعه و شرط */
.form-section{background:#c8e6c9;padding:12px;border-radius:10px;margin-top:60px;margin-bottom:12px;}
label{margin-top:8px;display:block;}
select,input,button{width:95%;padding:8px;margin:6px auto;display:block;border-radius:8px;border:1px solid #9e9e9e;font-size:14px;}
.result-box{background:white;padding:10px;margin-top:10px;border-radius:10px;min-height:40px;box-shadow:0 3px 8px rgba(0,0,0,0.08);}
canvas{border:1px solid #aaa;border-radius:10px;margin-top:10px;}
button.navBtn{background:#4caf50;color:white;margin-top:12px;}
</style>
</head>
<body>
<div class="container">

  <!-- پروفایل -->
  <div class="profile-container" id="profileContainer">
    <img id="profileImg" src="" alt="پروفایل">
    <div class="profile-popup" id="profilePopup">
      <button id="editProfileBtn">ویرایش</button>
      <button id="viewScoresBtn">امتیازها</button>
      <button id="viewSavedBtn">ذخیره شده‌ها</button>
    </div>
  </div>

  <!-- فرم مجموعه -->
  <div class="form-section">
    <label for="knownSetSelect">عضو کدام مجموعه شناخته شده است؟</label>
    <select id="knownSetSelect">
      <option value="">انتخاب کنید</option>
      <option value="N">N (طبیعی)</option>
      <option value="W">W (صفر و طبیعی)</option>
      <option value="Z">Z (صحیح)</option>
      <option value="Q">Q (گویا)</option>
      <option value="I">I (گنگ)</option>
      <option value="R">R (حقیقی)</option>
    </select>
    <label for="textCondition">شرط کلامی مجموعه A را وارد کنید:</label>
    <input type="text" id="textCondition" placeholder="مثال: بزرگتر مساوی 3 و کوچکتر از 7">
    <button id="showMathBtn">نمایش نماد ریاضی</button>
  </div>

  <!-- نتیجه ریاضی -->
  <div class="result-box" id="mathResult">نماد ریاضی در اینجا نمایش داده می‌شود</div>

  <!-- نمودار و محور -->
  <canvas id="vennCanvas" width="420" height="160"></canvas>
  <canvas id="axisCanvas" width="420" height="140"></canvas>

  <!-- نمایش اعضا -->
  <div class="result-box" id="membersDisplay">اعضا در اینجا نمایش داده می‌شود</div>

  <!-- دکمه رفتن به صفحه ۴ -->
  <button class="navBtn" onclick="location.href='page4.html'">انجام عملیات ریاضی</button>

</div>

<script>
// پروفایل
const profileContainer = document.getElementById('profileContainer');
const profilePopup = document.getElementById('profilePopup');
const profileImg = document.getElementById('profileImg');

function loadProfile(){ 
  profileImg.src = localStorage.getItem('profileImage') || 'https://via.placeholder.com/45?text=؟'; 
}
loadProfile();
profileContainer.onclick = ()=> profilePopup.style.display = profilePopup.style.display==='block'?'none':'block';

// تبدیل کلامی به ریاضی
function convertToMath(condText){
  let cond = condText.trim();
  cond = cond.replace(/از/gi,'')
             .replace(/بزرگتر مساوی/gi,"≥")
             .replace(/کوچکتر مساوی/gi,"≤")
             .replace(/بزرگتر/gi,">")
             .replace(/کوچکتر/gi,"<")
             .replace(/مساوی/gi,"=")
             .replace(/و/gi," ∧ ")
             .replace(/یا/gi," ∨ ");
  let parts = cond.split(/ ∧ | ∨ /);
  let newParts = parts.map(p=>"x"+p.trim());
  return newParts.join(", ");
}

// استخراج اعداد
function extractNumbers(condText){
  const nums = condText.match(/-?\d+/g);
  return nums? nums.map(n=>parseInt(n,10)):[];  
}

// نمایش ریاضی و ذخیره
document.getElementById('showMathBtn').onclick = function(){
  const condText = document.getElementById('textCondition').value.trim();
  const set = document.getElementById('knownSetSelect').value;
  if(!set){ alert('لطفاً یک مجموعه شناخته شده انتخاب کنید'); return; }
  if(!condText){ alert('لطفاً شرط را وارد کنید'); return; }
  const mathCond = convertToMath(condText);
  const mathExpr = `{ x ∈ ${set} | (${mathCond}) }`;
  document.getElementById('mathResult').innerText = mathExpr;

  // ذخیره برای صفحه بعد
  localStorage.setItem('page3_mathExpr', mathExpr);
  localStorage.setItem('page3_condText', condText);
  localStorage.setItem('page3_set', set);

  showVenn();
  showAxis();
  showMembers();
}

// نمودار ون
function showVenn(){
  const canvas = document.getElementById('vennCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const set = document.getElementById('knownSetSelect').value;
  const nums = extractNumbers(document.getElementById('textCondition').value);

  if(!['N','W','Z'].includes(set) || nums.length===0){
    ctx.font='16px Tahoma'; ctx.fillStyle='red'; ctx.textAlign='center';
    ctx.fillText('نمایش نمودار امکان‌پذیر نیست',canvas.width/2,canvas.height/2);
    return;
  }

  const lower = nums[0], upper = nums[1]||null;
  let arr = [];
  if(upper!==null) for(let i=lower;i<=upper;i++) arr.push(i);
  else for(let i=lower;i<lower+5;i++) arr.push(i);

  const cx = canvas.width/2, cy = canvas.height/2, r = 60;
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,2*Math.PI);
  ctx.strokeStyle='blue'; ctx.lineWidth=2;
  ctx.stroke();
  ctx.fillStyle='black'; ctx.font='14px Tahoma'; ctx.textAlign='center';
  arr.forEach((n,i)=>{ctx.fillText(n,cx - r/2 + i*18, cy);});
}

// محور پیشرفته
function showAxis(){
  const canvas = document.getElementById('axisCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const set = document.getElementById('knownSetSelect').value;
  const nums = extractNumbers(document.getElementById('textCondition').value);

  if(nums.length===0) return;
  const lower = nums[0], upper = nums[1]||null;
  const finite = upper!==null;
  let arr = finite ? Array.from({length:upper-lower+1},(_,i)=>lower+i) : Array.from({length:5},(_,i)=>lower+i);
  const spacing=(canvas.width-80)/(arr.length+1);

  ctx.strokeStyle='black'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(40,canvas.height/2); ctx.lineTo(canvas.width-40,canvas.height/2); ctx.stroke();
  arr.forEach((n,i)=>{
    const xPos=40+spacing*(i+1);
    ctx.beginPath(); ctx.arc(xPos,canvas.height/2,5,0,2*Math.PI); ctx.fill();
    ctx.fillText(n,xPos,canvas.height/2-12);
  });

  if(finite){
    const rectStartX=40+spacing*0.5;
    const rectEndX=40+spacing*(arr.length+0.5);
    ctx.strokeStyle='blue'; ctx.lineWidth=2;
    ctx.strokeRect(rectStartX-10,canvas.height/2-15,rectEndX-rectStartX+20,30);
  }
}

// نمایش اعضا
function showMembers(){
  const set = document.getElementById('knownSetSelect').value;
  const nums = extractNumbers(document.getElementById('textCondition').value);
  const div = document.getElementById('membersDisplay');

  if(!['N','W','Z'].includes(set) || nums.length===0){
    div.innerText='اعضا قابل نمایش نیست';
    return;
  }

  const lower = nums[0], upper = nums[1]||null;
  let arr = [];
  if(upper!==null){
    for(let i=lower;i<=upper;i++) arr.push(i);
  } else {
    for(let i=lower;i<lower+5;i++) arr.push(i);
  }
  div.innerText = `{ ${arr.join(', ')}${upper===null?' ...':''} }`;
}
</script>
</body>
</html>
